#
# plycutter - generate finger-jointed laser cutter templates from 3D objects
# Copyright (C) 2021 Tuomas J. Lukka
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.
#

########
#
# Weird cases from random testing or from runs

# This file contains data printed out from actual runs that contain
# very long rational numbers. We will *not* try to flake8 this one...

# flake8: noqa

import hypothesis as hyp
import hypothesis.strategies as hys
import numpy as np

from ....plytypes import F

from ...geom2d import Geom2D
from .. import geom2d_simple_holes


def test_union_weirdness_1():
    """Came from a union op"""
    mpq = F
    geoms = (
        geom2d_simple_holes.Geom2D_Py_Simple_Holes(
            [
                geom2d_simple_holes.Simple_Polygon_With_Holes(
                    (
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(200, 1),
                        ),
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(206, 1),
                        ),
                        (mpq(-20, 1), mpq(206, 1)),
                        (mpq(-20, 1), mpq(230, 1)),
                        (mpq(-6, 1), mpq(230, 1)),
                        (
                            mpq(-6, 1),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (mpq(-6, 1), mpq(217201, 1000)),
                        (mpq(0, 1), mpq(217201, 1000)),
                        (mpq(0, 1), mpq(213201, 1000)),
                        (mpq(-6, 1), mpq(213201, 1000)),
                        (mpq(-6, 1), mpq(1046, 5)),
                        (mpq(0, 1), mpq(1046, 5)),
                        (
                            mpq(0, 1),
                            mpq(
                                4861035122508509584330961788411610764321790907678973448204642920666539014979332015952722574695279066256537422111152771158294323344283899847059605088200142606119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                199293691428174605411612328439522552981808485190234338940459569515632712074773094908197743970842491666152008407321557253945615441956761616837596150050262115691839,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4860306072952318955501203047965486734706379072295342411877077068025256720031038870464065775389949895392701930508177240862923338747710710106072300207704831676199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4763038296870053769559429500584704009566565539262669955170359224752393603987605346237924863503668379423015897282583886293266468032679347138273919053831009980199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                195263427734542676315873606051035267533382243883644168108485318488250951209991317976583872223795857601292422532099648959458166636039230730180598839672707392220479,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4762309247313863140729670760138579979951153703879038918842793372111111309039312200749268064198339208559180405679608355997895483436106157397286614173335699050279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4762309247313863140729670760138579979951153703879038918842793372111111309039312200749268064198339208559180405679608355997895483436106157397286614173335699050279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4666560738934158482337891540042451144930574624459908600066643449332758220996269352817932070734343062999478912620583618367580054034139214958154873801622793998119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4666560738934158482337891540042451144930574624459908600066643449332758220996269352817932070734343062999478912620583618367580054034139214958154873801622793998119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                191320241701626210229896448256387008586768617578252680166801591190947699521467525719671333308444115532612609518208221989526330400240829536392502167300590822763839,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4665831689377967853508132799596327115315162789076277563739077596691475926047976207329275271429013892135643421017608088072209069437566025217167568921127483068199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4529720772229126964509519418765212136193472786098388974437342894738042189103622942080569955040009270159919767025236417752334155059527658271675803215156672188199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                185697409224264677308827292696436100725085441003908647898431648957662543199748039406132320976785834121505481191548402749279941804140011486650076090287059542748479,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4528991722672936335679760678319088106578060950714757938109777042096759894155329796591913155734680099296084275422260887456963170462954468530688498334661361258279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4528991722672936335679760678319088106578060950714757938109777042096759894155329796591913155734680099296084275422260887456963170462954468530688498334661361258279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4433243114085461563498741763715751962005567635001855322024361438130190196256819803281998693176925039849084966552227241841740222504519391378486327703854493454119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4433243114085461563498741763715751962005567635001855322024361438130190196256819803281998693176925039849084966552227241841740222504519391378486327703854493454119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                181754219082829636557491307426992342086843331010472495767068028731642410507150094188698064828589976583446457729405610551966897307526416769626091777292090500459839,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4432514064529270934668983023269627932390155799618224285696795585488907901308526657793341893871595868985249474949251711546369237907946201637499022823359182524199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4335307457037186400006662749951366335158636182122223592769403696910175791035926234720965424928562518659637173707545974773040363125291561798258694512874813116199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                177726463301395114164210169275068422882657140240885867250046141846720020878972474404388535242216517309993894865523094587128896334836331531239974633493503320796479,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4334578407480995771176904009505242305543224346738592556441837844268893496087633089232308625623233347795801682104570444477669378528718372057271389632379502186279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4334578407480995771176904009505242305543224346738592556441837844268893496087633089232308625623233347795801682104570444477669378528718372057271389632379502186279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4238829850299351352283819749121798085400417516444499020051619645972102601011245197667503719217732834639808962940255122511308194031792700168511657464875560718119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4238829850299351352283819749121798085400417516444499020051619645972102601011245197667503719217732834639808962940255122511308194031792700168511657464875560718119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                173783275267599117897679504828640233146032176149620887386185615253160819102081535358503770896263096169866141581314753659419184140144622430017130297493954258283839,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4238100800743160723454061008675674055785005681060867983724053793330820306062952052178846919912403663775973471337279592215937209435219510427524352584380249788199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                4140894185447219618565991437236975730619933055824363990309475634762914284638980298486742638483702138524405273444663278028283778537906721303859143476243789500199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                169755519166206476125142645453778408096570312062673623549189091298682299116697691018785400997977241724449386954744904020593876366753553070969593040991631352540479,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                4140165135891028989736232696790851701004521220440732953981909782121631989690687152998085839178372967660569781841687747732912793941333531562871838595748478570279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                4140165135891028989736232696790851701004521220440732953981909782121631989690687152998085839178372967660569781841687747732912793941333531562871838595748478570279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (mpq(-6, 1), mpq(150, 1)),
                        (mpq(-20, 1), mpq(150, 1)),
                        (mpq(-20, 1), mpq(200, 1)),
                    ),
                    [
                        [
                            (
                                mpq(-22218929596953719, 2199023255552000),
                                mpq(206, 1),
                            ),
                            (mpq(-6, 1), mpq(206, 1)),
                            (
                                mpq(-6, 1),
                                mpq(
                                    4861035122508509584330961788411610764321790907678973448204642920666539014979332015952722574695279066256537422111152771158294323344283899847059605088200142606119,
                                    24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                                ),
                            ),
                            (mpq(-6, 1), mpq(200, 1)),
                            (
                                mpq(-22218929596953719, 2199023255552000),
                                mpq(200, 1),
                            ),
                        ]
                    ],
                )
            ]
        ),
        geom2d_simple_holes.Geom2D_Py_Simple_Holes(
            [
                geom2d_simple_holes.Simple_Polygon_With_Holes(
                    (
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(206, 1),
                        ),
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(20597, 100),
                        ),
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(20003, 100),
                        ),
                        (
                            mpq(-146492149776823501, 8796093022208000),
                            mpq(200, 1),
                        ),
                        (
                            mpq(-146756032567489741, 8796093022208000),
                            mpq(200, 1),
                        ),
                        (mpq(-20, 1), mpq(200, 1)),
                        (mpq(-20, 1), mpq(150, 1)),
                        (mpq(-6, 1), mpq(150, 1)),
                        (
                            mpq(-6, 1),
                            mpq(
                                3807522833370981220625570842496489258133387287100203519833892482801452468847352434891880033979248728944052299757267983158914138505502997345403225757441343082279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                3978215095234883853621437223941647759954756515243942070431710358645646171632192742252472672057780470436511706151004767269624945161129528781284128197197541134119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(
                                4140894185447219618565991437236975730619933055824363990309475634762914284638980298486742638483702138524405273444663278028283778537906721303859143476243789500199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                4140894185447219618565991437236975730619933055824363990309475634762914284638980298486742638483702138524405273444663278028283778537906721303859143476243789500199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                3978215095234883853621437223941647759954756515243942070431710358645646171632192742252472672057780470436511706151004767269624945161129528781284128197197541134119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3978215095234883853621437223941647759954756515243942070431710358645646171632192742252472672057780470436511706151004767269624945161129528781284128197197541134119,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                163098070309955950452521821296254069802760075100398052451769334472776105497540384686487497962705049237530954052955489094510170936447432403140801597519155455339839,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                3977486045678693224791678483495523730339344679860311034104144506004363876683899596763815872752451299572676214548029236974253960564556339040296823316702230204199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(3, 100),
                            mpq(
                                3808251882927171849455329582942613287748799122483834556161458335442734763795645580380536833284577899807887791360243513454285123102076187086390530637936654012199,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(
                                156117184762884517591605509427709547938853820795711916749120382026554938762120967576430962984813147937072170189283693673059931493884501168053379914621038797532479,
                                996367726793859400670278609702840474396175024295749647673331943085803096000632167830959050616533513908505190733224737007012281983359312682650003343591604224000,
                            ),
                        ),
                        (
                            mpq(0, 1),
                            mpq(
                                3807522833370981220625570842496489258133387287100203519833892482801452468847352434891880033979248728944052299757267983158914138505502997345403225757441343082279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(
                                3807522833370981220625570842496489258133387287100203519833892482801452468847352434891880033979248728944052299757267983158914138505502997345403225757441343082279,
                                24301651873020960991958014870800987180394512787701210918861754709409831609771516288559976844305695461183053432517676512366153219106324699576829349843697664000,
                            ),
                        ),
                        (mpq(-597, 100), mpq(150, 1)),
                        (mpq(-24513, 4100), mpq(614913, 4100)),
                        (mpq(-6, 1), mpq(14997, 100)),
                        (mpq(-20, 1), mpq(14997, 100)),
                        (mpq(-82087, 4100), mpq(614913, 4100)),
                        (mpq(-2003, 100), mpq(150, 1)),
                        (mpq(-2003, 100), mpq(200, 1)),
                        (mpq(-82087, 4100), mpq(820087, 4100)),
                        (mpq(-20, 1), mpq(20003, 100)),
                        (
                            mpq(-146756032567489741, 8796093022208000),
                            mpq(20003, 100),
                        ),
                        (
                            mpq(-146756032567489741, 8796093022208000),
                            mpq(20597, 100),
                        ),
                        (mpq(-20, 1), mpq(20597, 100)),
                        (mpq(-82087, 4100), mpq(844513, 4100)),
                        (mpq(-2003, 100), mpq(206, 1)),
                        (mpq(-2003, 100), mpq(230, 1)),
                        (mpq(-82087, 4100), mpq(943087, 4100)),
                        (mpq(-20, 1), mpq(23003, 100)),
                        (mpq(-6, 1), mpq(23003, 100)),
                        (mpq(-24513, 4100), mpq(943087, 4100)),
                        (mpq(-597, 100), mpq(230, 1)),
                        (
                            mpq(-597, 100),
                            mpq(3979270494998090721, 17592186044416000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(3979270494998090721, 17592186044416000),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(163143757107945729801, 721279627821056000),
                        ),
                        (
                            mpq(3, 100),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(3, 100),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (
                            mpq(87, 4100),
                            mpq(79766234940200074043, 360639813910528000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(1945440691383221443, 8796093022208000),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(1945440691383221443, 8796093022208000),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (
                            mpq(0, 1),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(3978742729416758241, 17592186044416000),
                        ),
                        (
                            mpq(-6, 1),
                            mpq(3979270494998090721, 17592186044416000),
                        ),
                        (mpq(-6, 1), mpq(230, 1)),
                        (mpq(-20, 1), mpq(230, 1)),
                        (mpq(-20, 1), mpq(206, 1)),
                        (
                            mpq(-146756032567489741, 8796093022208000),
                            mpq(206, 1),
                        ),
                    ),
                    [],
                )
            ]
        ),
        geom2d_simple_holes.Geom2D_Py_Simple_Holes(
            [
                geom2d_simple_holes.Simple_Polygon_With_Holes(
                    (
                        (
                            mpq(-22218929596953719, 2199023255552000),
                            mpq(20597, 100),
                        ),
                        (
                            mpq(-22218929596953719, 2199023255552000),
                            mpq(206, 1),
                        ),
                        (
                            mpq(-22152958899287159, 2199023255552000),
                            mpq(206, 1),
                        ),
                        (mpq(-603, 100), mpq(206, 1)),
                        (mpq(-6, 1), mpq(206, 1)),
                        (mpq(-6, 1), mpq(20597, 100)),
                        (mpq(-6, 1), mpq(20003, 100)),
                        (mpq(-24513, 4100), mpq(820087, 4100)),
                        (mpq(-597, 100), mpq(200, 1)),
                        (mpq(-1, 1000), mpq(200, 1)),
                        (mpq(0, 1), mpq(200, 1)),
                        (mpq(0, 1), mpq(1046, 5)),
                        (mpq(-597, 100), mpq(1046, 5)),
                        (mpq(-6, 1), mpq(1046, 5)),
                        (mpq(-6, 1), mpq(20923, 100)),
                        (mpq(-6, 1), mpq(213171, 1000)),
                        (mpq(-6, 1), mpq(213201, 1000)),
                        (mpq(-597, 100), mpq(213201, 1000)),
                        (mpq(0, 1), mpq(213201, 1000)),
                        (mpq(0, 1), mpq(217201, 1000)),
                        (mpq(-597, 100), mpq(217201, 1000)),
                        (mpq(-6, 1), mpq(217201, 1000)),
                        (mpq(-6, 1), mpq(217231, 1000)),
                        (
                            mpq(-6, 1),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (
                            mpq(-597, 100),
                            mpq(1945704574173887683, 8796093022208000),
                        ),
                        (mpq(-597, 100), mpq(217231, 1000)),
                        (mpq(0, 1), mpq(217231, 1000)),
                        (mpq(87, 4100), mpq(8906111, 41000)),
                        (mpq(3, 100), mpq(217201, 1000)),
                        (mpq(3, 100), mpq(213201, 1000)),
                        (mpq(87, 4100), mpq(8740371, 41000)),
                        (mpq(0, 1), mpq(213171, 1000)),
                        (mpq(-597, 100), mpq(213171, 1000)),
                        (mpq(-597, 100), mpq(20923, 100)),
                        (mpq(0, 1), mpq(20923, 100)),
                        (mpq(87, 4100), mpq(857807, 4100)),
                        (mpq(3, 100), mpq(1046, 5)),
                        (mpq(3, 100), mpq(200, 1)),
                        (mpq(87, 4100), mpq(819913, 4100)),
                        (mpq(0, 1), mpq(19997, 100)),
                        (mpq(-1, 1000), mpq(19997, 100)),
                        (mpq(-6, 1), mpq(19997, 100)),
                        (mpq(-24687, 4100), mpq(819913, 4100)),
                        (mpq(-603, 100), mpq(200, 1)),
                        (
                            mpq(-22152958899287159, 2199023255552000),
                            mpq(200, 1),
                        ),
                        (
                            mpq(-22218929596953719, 2199023255552000),
                            mpq(200, 1),
                        ),
                        (
                            mpq(-22218929596953719, 2199023255552000),
                            mpq(20003, 100),
                        ),
                    ),
                    [
                        [
                            (mpq(-603, 100), mpq(20003, 100)),
                            (
                                mpq(-22152958899287159, 2199023255552000),
                                mpq(20003, 100),
                            ),
                            (
                                mpq(-22152958899287159, 2199023255552000),
                                mpq(20597, 100),
                            ),
                            (mpq(-603, 100), mpq(20597, 100)),
                        ]
                    ],
                )
            ]
        ),
    )
    Geom2D.union(geoms)


def test_union_weirdness_2():
    """Problem: cell point outside AABB --> just hit inside AABB. Fixed."""
    mpq = F
    geoms = [
        geom2d_simple_holes.Geom2D_Py_Simple_Holes(
            [
                geom2d_simple_holes.Simple_Polygon_With_Holes(
                    [
                        [
                            mpq(-4509467319214276359, 63771674411008000),
                            mpq(-173828038461153611, 351843720888320),
                        ],
                        [
                            mpq(-184980629015681292319, 2614638650851328000),
                            mpq(-7126738470674765059, 14425592556421120),
                        ],
                        [mpq(-47534534803, 671744000), mpq(-10126971, 20500)],
                        [mpq(-47500947603, 671744000), mpq(-10126971, 20500)],
                        [
                            mpq(-4509467319214276359, 63771674411008000),
                            mpq(-34762089255021839, 70368744177664),
                        ],
                    ],
                    [],
                )
            ]
        ),
        geom2d_simple_holes.Geom2D_Py_Simple_Holes(
            [
                geom2d_simple_holes.Simple_Polygon_With_Holes(
                    [
                        [mpq(-1901026187, 26869760), mpq(-2531921, 5125)],
                        [mpq(-9268663, 131072), mpq(-246999, 500)],
                        [mpq(-47500947603, 671744000), mpq(-10126971, 20500)],
                        [mpq(-47524704403, 671744000), mpq(-2531924, 5125)],
                    ],
                    [],
                )
            ]
        ),
    ]
    Geom2D.union(geoms)
